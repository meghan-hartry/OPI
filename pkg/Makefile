# Makefile to build OPI

OPI_VERSION := $(shell cat OPI/DESCRIPTION | grep Version | sed 's/Version: //')

# R files for OPI package
OPI_R =	\
    dbTocd.r \
    fourTwo.r full_threshold.r full_threshold_state.r zest.r mocs.r \
    imoClient.r kowaAP7000Client.r octopus600.r octopus900Client.r \
    dayDreamClient.r viveClient.r \
    opi.r \
    simDisplay.r simG.r simH.r simH_RT.r simNo.r simYes.r

# Rd files for OPI package
OPI_MAN	= \
    RtDbUnits.Rd RtSigmaUnits.Rd ZEST.Rd\
    chooseOpi.Rd dbTocd.Rd fourTwo.Rd opiClose.Rd opiInitialize.Rd opiKineticStimulus.Rd\
    opiPresent.Rd opiQueryDevice.Rd opiSetBackground.Rd opiStaticStimulus.Rd\
    opiTemporalStimulus.Rd

OPI_ROOT	=	DESCRIPTION \
				NAMESPACE

OPI_FILES	=	$(addprefix OPI/,$(OPI_ROOT)) \
				$(addprefix OPI/man/,$(OPI_MAN)) \
				$(addprefix OPI/R/,$(OPI_R))


all: build install

check: OPI.Rcheck

clean:
	rm -rf OPI*.Rcheck
	rm -rf OPI*.tar.gz

build: 
	R CMD build OPI

install:
	R CMD INSTALL OPI_$(OPI_VERSION).tar.gz

OPI.Rcheck: $(OPI_FILES)
	R CMD check --as-cran OPI
	#R CMD check OPI

